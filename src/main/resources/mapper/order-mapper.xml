<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.OrderMapper">
	<resultMap type="buy" id="buy">
		<id column="B_NUM" property="buyNo" />
		<result column="DATE_ORDER" property="dateOrder" />
		<result column="DATE_RECEIVED" property="dateReceived" />
		<result column="M_AMOUNT" property="materioalAmount" />
		<result column="B_NAME" property="buyName" />
		<result column="C_NUM" property="companyNo" />
		<result column="MATERIAL_NAME" property="materioalName" />
		<result column="M_NUM" property="materialNo" />
		<result column="M_BOX_COUNT" property="mBOXcount" />
		<result column="M_UNIT" property="mUnit" />
		<result column="M_PRICE_TOTAL" property="mTotalPrice" />
		<result column="M_NAME" property="managerName" />
		<result column="M_CONTACT" property="managerContact" />
		<result column="M_MAIL" property="mMail" />
	</resultMap>


	<!-- //Order 발주관리 페이지 - 전체 조회- 사용된 테이블 Table : BUY, COMPANY_BUY, MATERIAL(총3개) -->
	<select id="viewAllOrder" resultMap="buy">
	SELECT  
		b.B_NUM, cb.B_NAME, m.M_NUM, m.MATERIAL_NAME, b.DATE_ORDER,
		 b.DATE_RECEIVED, b.M_AMOUNT, b.C_NUM
	FROM
		BUY b , COMPANY_BUY cb , MATERIAL m
	WHERE
		 b.C_NUM = cb.C_NUM(+) AND m.C_NUM = b.C_NUM(+)
	</select>

	<!-- //발주관리 -발주번호 문자열 검색으로 조회-->
	<select id="searchUser" parameterType="map" resultMap="buy">
	SELECT
   		 b.B_NUM,
   		 cb.B_NAME,
   		 m.M_NUM,
   		 m.MATERIAL_NAME,
   		 b.DATE_ORDER,
    	 b.DATE_RECEIVED,
   		 b.M_AMOUNT
	FROM
		BUY b , COMPANY_BUY cb , MATERIAL m
	WHERE
		 b.C_NUM = cb.C_NUM(+) AND m.C_NUM = b.C_NUM(+)
	AND
		 b.B_NUM LIKE '%' || #{search} || '%'
	</select> 

	<!-- 발주 날짜도 함께 검색 + 문자열 조회	 -->
 	<select id="searchUserByDateRange" parameterType="map" resultMap="buy">
	SELECT
   		 b.B_NUM,
   		 cb.B_NAME,
   		 m.M_NUM,
   		 m.MATERIAL_NAME,
   		 b.DATE_ORDER,
    	 b.DATE_RECEIVED,
   		 b.M_AMOUNT
	FROM
		BUY b , COMPANY_BUY cb , MATERIAL m
	WHERE
		 b.C_NUM = cb.C_NUM(+) AND m.C_NUM = b.C_NUM(+)
	AND
 		 b.DATE_ORDER BETWEEN #{startDate} AND #{endDate}
 	AND
		 b.B_NUM LIKE '%' || #{search} || '%'
    </select>
    
	<!-- 발주 항목 선택 열 삭제 -->
	<delete id="deleteOrdersByCompanyNo" parameterType="string">
    DELETE FROM BUY
    WHERE C_NUM = #{companyNo}
	</delete> 

	<!-- COMPANY_BUY 테이블에서 삭제 -->
	<delete id="deleteCompanyBuyByCompanyNo" parameterType="string">
    DELETE FROM COMPANY_BUY 
    WHERE C_NUM = #{companyNo}
	</delete> 

	<!-- MATERIAL 테이블에서 삭제 -->
	<delete id="deleteMaterialByCompanyNo" parameterType="string">
    DELETE FROM MATERIAL 
    WHERE C_NUM = #{companyNo}
	</delete>

	<!-- //Material 협력업체정보 페이지 - 전체 조회- 사용된 테이블 Table : BUY, COMPANY_BUY, MATERIAL(총3개) -->
	<select id="viewAllMaterial" resultMap="buy">
	SELECT  
		b.M_PRICE_TOTAL, b.M_NUM, m.MATERIAL_NAME, m.M_BOX_COUNT, b.DATE_ORDER, m.M_UNIT, cb.B_NAME, b.C_NUM
	FROM
		BUY b , COMPANY_BUY cb , MATERIAL m
	WHERE
		 b.C_NUM = cb.C_NUM(+) AND m.C_NUM = b.C_NUM(+)
	</select>
	
	<!--원부재료 문자열 조회 -->
	<select id="searchMaterial" parameterType="map" resultMap="buy">
	SELECT  
		b.M_PRICE_TOTAL, b.M_NUM, m.MATERIAL_NAME, m.M_BOX_COUNT, b.DATE_ORDER, m.M_UNIT, cb.B_NAME, b.C_NUM
	FROM
		BUY b , COMPANY_BUY cb , MATERIAL m
	WHERE
		 b.C_NUM = cb.C_NUM(+) AND m.C_NUM = b.C_NUM(+)
	AND
		 b.M_NUM LIKE '%' || #{search} || '%' 
	</select> 

	<!-- 원부재료 선택 BUY 테이블에서 삭제 -->
	<delete id="deleteBuy" parameterType="string">
    DELETE FROM BUY
    WHERE C_NUM = #{companyNo}
	</delete> 

	<!-- COMPANY_BUY 테이블에서 삭제 -->
	<delete id="deleteCompanyBuy" parameterType="string">
    DELETE FROM COMPANY_BUY 
    WHERE C_NUM = #{companyNo}
	</delete> 

	<!-- MATERIAL 테이블에서 삭제 -->
	<delete id="deleteMaterial" parameterType="string">
    DELETE FROM MATERIAL 
    WHERE C_NUM = #{companyNo}
	</delete>

	<!-- //Contractor 협력업체정보 페이지 - 전체 조회- 사용된 테이블 Table : BUY, COMPANY_BUY, MATERIAL(총3개) -->
	<select id="viewAllContractor" resultMap="buy">
	SELECT  
		cb.B_NAME, cb.C_NUM, mr.M_NAME, mr.M_CONTACT, mr.	M_MAIL
	FROM
		COMPANY_BUY cb , MANAGER mr
	WHERE
		 cb.C_NUM = mr.C_NUM(+)
	</select>

	<!-- 원부재료 선택 BUY 테이블에서 삭제 -->
	<delete id="deleteManagerContractor" parameterType="string">
    DELETE FROM MANAGER
    WHERE C_NUM = #{companyNo}
	</delete> 

	<!-- COMPANY_BUY 테이블에서 삭제 -->
	<delete id="deleteCompanyBuyContractor" parameterType="string">
    DELETE FROM COMPANY_BUY 
    WHERE C_NUM = #{companyNo}
	</delete> 

	<!--OrderRegister 발주관리 등록 - 사용된 테이블 Table : BUY, COMPANY_BUY, MATERIAL(총3개) -->
	<!--buy 테이블에 속한 데이터 등록-->
	<insert id="insertIntoBuy" parameterType="buy">
  		INSERT INTO BUY (DATE_ORDER, DATE_RECEIVED, B_NUM, M_AMOUNT) 
  		VALUES(#{dateOrder},#{dateReceived},#{buyNo},#{materioalAmount})
  	</insert>
  	
	<!--company_buy 테이블에 속한 데이터 등록-->
	<insert id="insertIntoCompany" parameterType="buy">
  		INSERT INTO COMPANY_BUY (B_NAME, C_NUM) 
  		VALUES(#{buyName}, #{companyNo})
  	</insert>
  	
  	<!--material 테이블에 속한 데이터 등록-->
	<insert id="insertIntoMaterial" parameterType="buy">
  		INSERT INTO MATERIAL (MATERIAL_NAME, M_NUM) 
  		VALUES(#{materioalName}, #{materialNo})
  	</insert>
</mapper>